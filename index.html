<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Image Rename Pro + AI (V2.2 ç¨³å®šå¢å¼ºç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        :root {
            --primary: #007AFF;
            --primary-hover: #0062CC;
            --primary-light: #E5F1FF;
            --danger: #FF3B30;
            --success: #34C759;
            --info: #5856D6;
            --ai-phrase: #8E44AD;
            --ai-alt: #2980B9;
            --bg: #F5F5F7;
            --card-bg: #FFFFFF;
            --border: #D1D1D6;
            --text: #1D1D1F;
            --text-secondary: #86868B;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "PingFang SC", sans-serif; 
            background: var(--bg); margin: 0; padding: 25px; color: var(--text); 
            -webkit-font-smoothing: antialiased;
        }
        
        .header { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto 15px; }
        .header-btns { display: flex; gap: 10px; }
        .container { display: flex; gap: 24px; max-width: 1400px; margin: 0 auto; height: 85vh; }
        
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 1000;
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: var(--card-bg); padding: 30px; border-radius: 20px;
            width: 500px; box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        #imageLightbox img { max-width: 90vw; max-height: 90vh; border-radius: 8px; box-shadow: 0 0 30px rgba(0,0,0,0.5); cursor: pointer; }

        .config-panel { 
            width: 380px; background: var(--card-bg); padding: 24px; border-radius: 18px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); display: flex; flex-direction: column; 
            border: 1px solid rgba(0,0,0,0.05); overflow-y: auto;
        }
        
        #drop-zone { 
            border: 2px dashed var(--border); border-radius: 12px; padding: 25px 15px; 
            text-align: center; color: var(--text-secondary); cursor: pointer; 
            background: #FAFAFA; margin-bottom: 15px; transition: 0.3s;
        }
        #drop-zone.dragover { border-color: var(--primary); background-color: var(--primary-light); color: var(--primary); }
        
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; }
        .modern-input-wrapper {
            display: flex; align-items: center; background: #F2F2F7;
            border-radius: 10px; padding: 4px 12px; border: 1px solid transparent;
        }
        .modern-input-wrapper input { border: none; background: transparent; flex: 1; outline: none; font-size: 13px; height: 36px; }

        .btn-add-tag { background: var(--primary); color: white; border: none; width: 28px; height: 28px; border-radius: 6px; cursor: pointer; margin-left: 5px; }
        .tag-container { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 6px; }
        .tag { background: #E9E9EB; padding: 3px 8px; border-radius: 6px; font-size: 11px; cursor: pointer; }

        textarea { width: 100%; border-radius: 10px; border: 1px solid var(--border); padding: 10px; font-size: 12px; background: #F2F2F7; resize: none; outline: none; box-sizing: border-box; }
        #manualDescInput { height: 80px; margin-bottom: 8px; }

        .preview-panel { flex: 1; background: var(--card-bg); padding: 24px; border-radius: 18px; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .list-area { flex: 1; overflow-y: auto; border-radius: 12px; background: #FAFAFA; border: 1px solid #EFEEF2; }
        
        table { width: 100%; border-collapse: collapse; }
        th { background: #F2F2F7; padding: 12px; text-align: left; font-size: 12px; color: var(--text-secondary); position: sticky; top: 0; z-index: 10; }
        td { padding: 12px; border-bottom: 1px solid #EFEEF2; vertical-align: middle; }
        
        .name-edit { width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 8px; font-size: 13px; font-weight: bold; margin-bottom: 5px; }
        .alt-box-group { display: flex; align-items: center; gap: 8px; background: #fff; padding: 8px; border-radius: 8px; border: 1px solid #eee; }
        .alt-input { flex: 1; border: none; font-size: 12px; outline: none; background: transparent; }
        .alt-ai-style { color: var(--ai-alt); font-weight: 500; }

        .btn { padding: 10px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 13px; }
        .btn-rule { background: var(--primary); color: white; margin-bottom: 10px; }
        .btn-phrase { background: var(--ai-phrase); color: white; margin-top: 5px; }
        .btn-alt { background: var(--ai-alt); color: white; margin-top: 5px; }
        .btn-success { background: var(--success); color: white; margin-top: 5px; }
        .btn-info { background: var(--info); color: white; margin-top: 5px; }
        .btn-outline { background: transparent; border: 1px solid var(--border); }
        
        .btn-mini { padding: 4px 8px; font-size: 11px; background: #fff; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; margin-right: 4px; transition: all 0.2s;}
        .btn-dl { color: var(--success); border-color: #D1F2D9; }
        .btn-del { color: var(--danger); border-color: #FFD5D2; }
        .btn-copied { background: var(--success) !important; color: white !important; border-color: var(--success) !important; }
        
        .thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; cursor: zoom-in; }
        .chk-col { width: 40px; text-align: center; }
        input[type="checkbox"] { transform: scale(1.2); cursor: pointer; }
        
        .status-bar { font-size: 12px; margin-top: 8px; text-align: right; color: var(--text-secondary); }
    </style>
</head>
<body>

<div class="header">
    <h2 id="ui-title">å›¾ç‰‡é‡å‘½åä¸“ä¸šç‰ˆ + AI</h2>
    <div class="header-btns">
        <button class="btn btn-outline" id="ui-settings-btn" onclick="openSettings()">âš™ï¸ è®¾ç½® (API & è§„åˆ™)</button>
        <button class="btn btn-outline" onclick="toggleLanguage()" id="ui-lang-btn">English</button>
    </div>
</div>

<div class="container">
    <div class="config-panel">
        <div id="drop-zone">
            <span id="ui-drop-text">ğŸ“ ç‚¹å‡»æˆ–æ‹–å…¥å›¾ç‰‡</span>
            <input type="file" id="fileInput" multiple accept="image/*" style="display:none">
        </div>
        
        <div class="input-group">
            <label id="ui-brand-label">å“ç‰Œåç§°</label>
            <div class="modern-input-wrapper">
                <input type="text" id="brandInput" placeholder="è¾“å…¥å“ç‰Œ">
                <button class="btn-add-tag" onclick="addTag('brand')">+</button>
            </div>
            <div id="brand-tags" class="tag-container"></div>
        </div>

        <div class="input-group">
            <label id="ui-product-label">äº§å“åç§°</label>
            <div class="modern-input-wrapper">
                <input type="text" id="productInput" placeholder="è¾“å…¥äº§å“å">
                <button class="btn-add-tag" onclick="addTag('product')">+</button>
            </div>
            <div id="product-tags" class="tag-container"></div>
        </div>
        
        <label id="ui-manual-label">æ‰‹åŠ¨æè¿°åˆ—è¡¨</label>
        <textarea id="manualDescInput" placeholder="æ¯è¡Œå¯¹åº”ä¸€å¼ å›¾..."></textarea>
        
        <button class="btn btn-rule" id="ui-apply-rule" onclick="applyGlobalRule()">âš¡ åº”ç”¨å‘½åè§„åˆ™åˆ°é¢„è§ˆ</button>

        <button class="btn btn-phrase" id="btnPhrase" onclick="runAI('phrase')">âœ¨ AI ç”Ÿæˆåç§° (å…¨éƒ¨)</button>
        <button class="btn btn-alt" id="btnAlt" onclick="runAI('alt')">ğŸ“ AI ç”Ÿæˆ Alt (å…¨éƒ¨)</button>
        <button class="btn btn-info" id="ui-txt-btn" onclick="downloadTxt()">ğŸ“„ ä¸‹è½½æ¸…å• (å…¨éƒ¨)</button>
        <button class="btn btn-success" id="zipBtn" disabled onclick="downloadAll()">ğŸ“¦ æ‰“åŒ…ä¸‹è½½ (ZIP + TXT)</button>
    </div>

    <div class="preview-panel">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 id="ui-preview-h3" style="margin:0">é‡å‘½åé¢„è§ˆ</h3>
            <span id="ui-select-count" style="font-size:12px; font-weight:600; color:var(--primary);">å·²é€‰æ‹©: 0</span>
        </div>
        <div class="list-area">
            <table>
                <thead>
                    <tr>
                        <th class="chk-col"><input type="checkbox" id="selectAll" onclick="toggleSelectAll(this.checked)"></th>
                        <th width="80" id="ui-th-img">é¢„è§ˆ</th>
                        <th id="ui-th-name">æ–°æ–‡ä»¶å & Alt Text</th>
                        <th width="120" id="ui-th-action">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="listContainer"></tbody>
            </table>
        </div>
        <div id="status" class="status-bar"></div>
    </div>
</div>

<div id="imageLightbox" class="modal" onclick="closeLightbox()"><img id="lightboxImg" src=""></div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header" style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <h3 id="ui-setting-h3">âš™ï¸ AI é…ç½®ä¸­å¿ƒ</h3>
            <button class="btn-mini" onclick="closeSettings()">âœ•</button>
        </div>
        <div class="input-group"><label>API Key</label><div class="modern-input-wrapper"><input type="password" id="settingApiKey"></div></div>
        <div class="input-group"><label id="ui-setting-p-rule">æ–‡ä»¶åè§„åˆ™</label><textarea id="settingPhrasePrompt" style="height: 60px;"></textarea></div>
        <div class="input-group"><label id="ui-setting-a-rule">Alt Text è§„åˆ™</label><textarea id="settingAltPrompt" style="height: 60px;"></textarea></div>
        <button class="btn btn-success" style="width:100%" id="ui-setting-save" onclick="saveSettings()">ä¿å­˜é…ç½®</button>
    </div>
</div>

<script>
    let files = [];
    let customNames = []; 
    let aiPhrases = []; 
    let aiAlts = [];    
    let currentLang = 'zh';
    let tags = { brand: [], product: [] };
    let selectedIndices = new Set(); 

    const defaultSettings = {
        apiKey: '',
        phrasePrompt: "Extract exactly 3 core visual keywords for a filename (color, material, object). Connect with underscores. Return ONLY the phrase, lowercase.",
        altPrompt: "Write a high-quality SEO Alt Text under 125 characters. Return ONLY the sentence."
    };

    const i18n = {
        en: {
            title: "Image Rename Pro + AI", langBtn: "ä¸­æ–‡", settingsBtn: "âš™ï¸ Settings",
            brandLabel: "Brand", productLabel: "Product", manualLabel: "Manual",
            btnPhrase: "âœ¨ AI Name", btnAlt: "ğŸ“ AI Alt", applyRule: "âš¡ Apply Naming Rule",
            txtBtn: "ğŸ“„ Download TXT", zipBtn: "ğŸ“¦ Download ZIP + TXT",
            thImg: "Preview", thName: "New Name & Alt", thAction: "Action",
            copy: "Copy", copied: "Copied!", del: "Del", dl: "DL", dropZone: "ğŸ“ Click/Drag",
            settingH3: "âš™ï¸ AI Config", settingSave: "Save", ruleP: "Name Rule", ruleA: "Alt Rule",
            previewH3: "Preview", statusDone: "Done.", selCount: "Selected: ",
            all: "(All)", selected: "(Selected)"
        },
        zh: {
            title: "å›¾ç‰‡é‡å‘½åä¸“ä¸šç‰ˆ + AI", langBtn: "English", settingsBtn: "âš™ï¸ è®¾ç½®",
            brandLabel: "å“ç‰Œåç§°", productLabel: "äº§å“åç§°", manualLabel: "æ‰‹åŠ¨æè¿°",
            btnPhrase: "âœ¨ AI ç”Ÿæˆåç§°", btnAlt: "ğŸ“ AI ç”Ÿæˆ Alt", applyRule: "âš¡ åº”ç”¨å‘½åè§„åˆ™åˆ°é¢„è§ˆ",
            txtBtn: "ğŸ“„ ä¸‹è½½æ¸…å• (TXT)", zipBtn: "ğŸ“¦ æ‰“åŒ…ä¸‹è½½ (ZIP + TXT)",
            thImg: "é¢„è§ˆ", thName: "æ–°æ–‡ä»¶å & Alt Text", thAction: "æ“ä½œ",
            copy: "å¤åˆ¶", copied: "å·²å¤åˆ¶ï¼", del: "ç§»é™¤", dl: "ä¸‹è½½", dropZone: "ğŸ“ ç‚¹å‡»æˆ–æ‹–å…¥å›¾ç‰‡",
            settingH3: "âš™ï¸ AI é…ç½®ä¸­å¿ƒ", settingSave: "ä¿å­˜é…ç½®", ruleP: "æ–‡ä»¶åè§„åˆ™", ruleA: "Alt Text è§„åˆ™",
            previewH3: "é‡å‘½åé¢„è§ˆ", statusDone: "å®Œæˆã€‚", selCount: "å·²é€‰æ‹©: ",
            all: "(å…¨éƒ¨)", selected: "(æ‰€é€‰)"
        }
    };

    window.onload = () => { loadSettings(); updateUI(); };

    function openLightbox(src) { document.getElementById('lightboxImg').src = src; document.getElementById('imageLightbox').style.display = 'flex'; }
    function closeLightbox() { document.getElementById('imageLightbox').style.display = 'none'; }
    function openSettings() { document.getElementById('settingsModal').style.display = 'flex'; }
    function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }
    
    function saveSettings() {
        localStorage.setItem('ai_config', JSON.stringify({
            apiKey: document.getElementById('settingApiKey').value.trim(),
            phrasePrompt: document.getElementById('settingPhrasePrompt').value.trim(),
            altPrompt: document.getElementById('settingAltPrompt').value.trim()
        }));
        closeSettings();
    }
    function loadSettings() {
        const saved = JSON.parse(localStorage.getItem('ai_config') || JSON.stringify(defaultSettings));
        document.getElementById('settingApiKey').value = saved.apiKey;
        document.getElementById('settingPhrasePrompt').value = saved.phrasePrompt;
        document.getElementById('settingAltPrompt').value = saved.altPrompt;
    }

    const dropZone = document.getElementById('drop-zone');
    dropZone.onclick = () => document.getElementById('fileInput').click();
    dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('dragover'); };
    dropZone.ondragleave = () => dropZone.classList.remove('dragover');
    dropZone.ondrop = (e) => { e.preventDefault(); dropZone.classList.remove('dragover'); addFiles(e.dataTransfer.files); };
    document.getElementById('fileInput').onchange = (e) => addFiles(e.target.files);

    function addFiles(incoming) {
        const newFiles = Array.from(incoming).filter(f => f.type.startsWith('image/'));
        newFiles.sort((a, b) => a.name.localeCompare(b.name, undefined, {numeric: true}));
        
        newFiles.forEach((f) => { 
            files.push(f);
            aiPhrases.push(""); 
            aiAlts.push(""); 
            customNames.push(f.name);
        });
        refreshList();
    }

    function applyGlobalRule() {
        const brand = document.getElementById('brandInput').value.trim();
        const product = document.getElementById('productInput').value.trim();
        const manualDescs = document.getElementById('manualDescInput').value.split('\n');

        files.forEach((file, i) => {
            const ext = file.name.split('.').pop();
            const sn = (i + 1).toString().padStart(2, '0');
            let desc = (manualDescs[i] && manualDescs[i].trim()) ? manualDescs[i].trim().replace(/\s+/g, '_') : aiPhrases[i];
            let newName = [brand, product, sn, desc].filter(Boolean).join('_') + '.' + ext;
            if (brand || product || desc) {
                customNames[i] = newName;
            }
        });
        refreshList();
    }

    function toggleSelectAll(checked) {
        selectedIndices = checked ? new Set(files.map((_, i) => i)) : new Set();
        refreshList();
    }
    function updateSelect(idx, checked) {
        checked ? selectedIndices.add(idx) : selectedIndices.delete(idx);
        updateCounters();
    }
    
    function updateCounters() {
        const L = i18n[currentLang];
        const hasSelection = selectedIndices.size > 0;
        const countSuffix = hasSelection ? `${L.selected} [${selectedIndices.size}]` : L.all;
        
        document.getElementById('ui-select-count').innerText = `${L.selCount} ${selectedIndices.size}`;
        document.getElementById('selectAll').checked = (selectedIndices.size === files.length && files.length > 0);
        
        document.getElementById('btnPhrase').innerText = `${L.btnPhrase} ${countSuffix}`;
        document.getElementById('btnAlt').innerText = `${L.btnAlt} ${countSuffix}`;
        document.getElementById('ui-txt-btn').innerText = `${L.txtBtn} ${countSuffix}`;
        document.getElementById('zipBtn').innerText = `${L.zipBtn} ${countSuffix}`;
    }

    function downloadSingle(idx) {
        const safeName = customNames[idx].replace(/[\\/:*?"<>|]/g, "_");
        saveAs(files[idx], safeName);
    }

    function downloadTxt() {
        const targets = selectedIndices.size > 0 ? Array.from(selectedIndices) : files.map((_, i) => i);
        if (targets.length === 0) return;
        saveAs(new Blob([generateTxtContent(targets)], {type: "text/plain"}), `Image_List.txt`);
    }

    // æ›´æ–°ï¼šæ‰“åŒ…ä¸‹è½½æ—¶è‡ªåŠ¨åŠ å…¥ TXT æ–‡ä»¶
    async function downloadAll() {
        const targets = selectedIndices.size > 0 ? Array.from(selectedIndices) : files.map((_, i) => i);
        if (targets.length === 0) return;
        
        const zip = new JSZip();
        const statusEl = document.getElementById('status');
        statusEl.innerText = "æ­£åœ¨æ‰“åŒ…ï¼Œè¯·ç¨å€™...";

        // æ·»åŠ å›¾ç‰‡
        targets.forEach(idx => {
            let cleanName = customNames[idx].replace(/[\\/:*?"<>|]/g, "_");
            zip.file(cleanName, files[idx]);
        });

        // è‡ªåŠ¨æ·»åŠ æ¸…å• TXT
        const txtContent = generateTxtContent(targets);
        zip.file("Image_Details_List.txt", txtContent);
        
        try {
            const blob = await zip.generateAsync({
                type: "blob",
                compression: "DEFLATE",
                compressionOptions: { level: 6 }
            });
            saveAs(blob, `Batch_Rename_${Date.now()}.zip`);
            statusEl.innerText = i18n[currentLang].statusDone;
        } catch (e) {
            statusEl.innerText = "æ‰“åŒ…å¤±è´¥: " + e.message;
        }
    }

    function generateTxtContent(targetIndices) {
        let content = `å¯¼å‡ºæ¸…å• (å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString()})\n${"=".repeat(40)}\n`;
        targetIndices.forEach(idx => {
            content += `[${idx+1}] æ–°æ–‡ä»¶å: ${customNames[idx]}\n    ALT æ–‡å­—: ${aiAlts[idx] || "æœªç”Ÿæˆ"}\n${"-".repeat(40)}\n`;
        });
        return content;
    }

    async function runAI(type) {
        const config = JSON.parse(localStorage.getItem('ai_config') || JSON.stringify(defaultSettings));
        if (!config.apiKey) return alert("è¯·åœ¨è®¾ç½®ä¸­å¡«å†™ API Key");

        const targets = selectedIndices.size > 0 ? Array.from(selectedIndices) : files.map((_, i) => i);
        if (targets.length === 0) return alert("æœªé€‰æ‹©å›¾ç‰‡");

        const btn = document.getElementById(type === 'phrase' ? 'btnPhrase' : 'btnAlt');
        const originalText = btn.innerText;
        btn.disabled = true;
        
        let processed = 0;
        for (const idx of targets) {
            document.getElementById('status').innerText = `AI æ­£åœ¨å¤„ç†: ${++processed} / ${targets.length}`;
            try {
                const prompt = type === 'phrase' ? config.phrasePrompt : config.altPrompt;
                const result = await callVisionAPI(files[idx], config.apiKey, prompt);
                
                if (type === 'phrase') {
                    const cleanPhrase = result.toLowerCase().replace(/\s+/g,'_').replace(/[^a-z0-9_]/g,'');
                    aiPhrases[idx] = cleanPhrase;
                    const ext = files[idx].name.split('.').pop();
                    const brand = document.getElementById('brandInput').value.trim();
                    const product = document.getElementById('productInput').value.trim();
                    const sn = (idx + 1).toString().padStart(2, '0');
                    customNames[idx] = [brand, product, sn, cleanPhrase].filter(Boolean).join('_') + '.' + ext;
                } else {
                    aiAlts[idx] = result;
                }
                refreshList(); 
            } catch (err) {
                console.error("AI Error:", err);
            }
        }
        
        btn.disabled = false;
        btn.innerText = originalText;
        document.getElementById('status').innerText = i18n[currentLang].statusDone;
    }

    async function callVisionAPI(file, key, prompt) {
        const base64 = await new Promise((r) => {
            const reader = new FileReader();
            reader.onload = () => r(reader.result.split(',')[1]);
            reader.readAsDataURL(file);
        });

        const response = await fetch("https://aihubmix.com/v1/chat/completions", {
            method: "POST",
            headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
            body: JSON.stringify({
                model: "gpt-4o-mini",
                messages: [{
                    role: "user",
                    content: [
                        { type: "text", text: prompt },
                        { type: "image_url", image_url: { url: `data:image/jpeg;base64,${base64}` } }
                    ]
                }]
            })
        });

        if (!response.ok) throw new Error("API è¯·æ±‚å¤±è´¥");
        const data = await response.json();
        return data.choices[0].message.content.trim();
    }

    function refreshList() {
        const container = document.getElementById('listContainer');
        container.innerHTML = '';
        document.getElementById('zipBtn').disabled = files.length === 0;

        files.forEach((file, i) => {
            const imgUrl = URL.createObjectURL(file);
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="chk-col"><input type="checkbox" ${selectedIndices.has(i)?'checked':''} onclick="updateSelect(${i}, this.checked)"></td>
                <td><img src="${imgUrl}" class="thumb" onclick="openLightbox('${imgUrl}')"></td>
                <td>
                    <input type="text" class="name-edit" id="name_${i}" value="${customNames[i]}" 
                           oninput="customNames[${i}] = this.value">
                    <div class="alt-box-group">
                        <input type="text" class="alt-input ${aiAlts[i]?'alt-ai-style':''}" id="alt_${i}" 
                               value="${aiAlts[i] || ""}" oninput="aiAlts[${i}] = this.value">
                        <button class="btn-mini" onclick="copyId('alt_${i}', this)">${i18n[currentLang].copy}</button>
                    </div>
                </td>
                <td>
                    <button class="btn-mini btn-dl" onclick="downloadSingle(${i})">${i18n[currentLang].dl}</button>
                    <button class="btn-mini btn-del" onclick="removeFile(${i})">${i18n[currentLang].del}</button>
                </td>
            `;
            container.appendChild(tr);
        });
        updateCounters();
    }

    // æ›´æ–°ï¼šå¤åˆ¶åé¦ˆæç¤º
    function copyId(id, btn) { 
        const el = document.getElementById(id); 
        el.select(); 
        document.execCommand('copy'); 
        
        // è§†è§‰åé¦ˆæ•ˆæœ
        const originalText = btn.innerText;
        btn.innerText = i18n[currentLang].copied;
        btn.classList.add('btn-copied');
        
        setTimeout(() => {
            btn.innerText = originalText;
            btn.classList.remove('btn-copied');
        }, 1500);
    }

    function removeFile(i) { 
        files.splice(i, 1); 
        aiPhrases.splice(i, 1); 
        aiAlts.splice(i, 1); 
        customNames.splice(i, 1);
        selectedIndices.delete(i); 
        refreshList(); 
    }
    
    function toggleLanguage() { currentLang = currentLang === 'zh' ? 'en' : 'zh'; updateUI(); }
    
    function addTag(type) {
        const val = document.getElementById(type + 'Input').value.trim();
        if (val && !tags[type].includes(val)) { tags[type].push(val); renderTags(type); }
    }
    function renderTags(type) {
        document.getElementById(type + '-tags').innerHTML = tags[type].map(t => `<div class="tag" onclick="document.getElementById('${type}Input').value='${t}';">${t}</div>`).join('');
    }
    function updateUI() {
        const L = i18n[currentLang];
        document.getElementById('ui-title').innerText = L.title;
        document.getElementById('ui-lang-btn').innerText = L.langBtn;
        document.getElementById('ui-settings-btn').innerText = L.settingsBtn;
        document.getElementById('ui-drop-text').innerText = L.dropZone;
        document.getElementById('ui-brand-label').innerText = L.brandLabel;
        document.getElementById('ui-product-label').innerText = L.productLabel;
        document.getElementById('ui-manual-label').innerText = L.manualLabel;
        document.getElementById('ui-apply-rule').innerText = L.applyRule;
        document.getElementById('ui-preview-h3').innerText = L.previewH3;
        document.getElementById('ui-th-img').innerText = L.thImg;
        document.getElementById('ui-th-name').innerText = L.thName;
        document.getElementById('ui-th-action').innerText = L.thAction;
        refreshList();
    }
</script>
</body>
</html>
